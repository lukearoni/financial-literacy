---
title: "Financial Literacy"
format: html
author: Luke Li
execute:
    echo: false
    warning: false
---

```{r}
# Load required libraries
library(tidyverse)
library(tidymodels)
library(broom)
library(gt)
library(marginaleffects)

# Step 1: Read CSV
df_raw <- read_csv("NFCSdata.csv")

df_raw <- df_raw |>
  mutate(
    # M6: Compound Interest (correct = 1 "More than $102")
    M6_correct = ifelse(M6 == 1, 1, 0),
    
    # M7: Inflation (correct = 3 "Less than today") 
    M7_correct = ifelse(M7 == 3, 1, 0),
    
    # M8: Bond Prices (correct = 2 "They will fall")
    M8_correct = ifelse(M8 == 2, 1, 0),
    
    # M9: Mortgage Terms (correct = 1 "True")
    M9_correct = ifelse(M9 == 1, 1, 0),
    
    # M10: Stock Diversification (correct = 2 "False")
    M10_correct = ifelse(M10 == 2, 1, 0),
    
    CreditCardBehavior = ifelse(F2_1 == 1, 1, 0)
)

# Step 2: Define column label mapping
column_labels <- c(
  A3Ar_w = "Age",
  A50A = "BinaryGender",
  A5_2015 = "Education",
  A8_2021 = "Income",
  M4 = "FinancialKnowledgeRating",
  M6_correct = "CompoundInterest",
  M7_correct = "Inflation",
  M8_correct = "BondPrices",
  M9_correct = "MortgageTerms",
  M10_correct = "StockDiversification",
  J5 = "EmergencyFund",
  CreditCardBehavior = "CreditCardBehavior"
)

df_clean <- df_raw |>
  filter(!if_any(everything(), ~ .x %in% c(98, 99, 999)))

# Step 3: Rename relevant columns and filter data
df <- df_clean |>
  rename_with(~ column_labels[.x], .cols = all_of(names(column_labels))) |>
  # Create composite financial literacy score
  mutate(fin_lit_score = CompoundInterest + Inflation + BondPrices + MortgageTerms + StockDiversification) |>
  # Drop missing values in any model-relevant columns
  drop_na(CreditCardBehavior, EmergencyFund, fin_lit_score, FinancialKnowledgeRating, Age, BinaryGender, Income, Education)
```


```{r}
#| cache: true
# IMPORTANT: Convert outcome variable to factor for classification
df$CreditCardBehavior <- factor(df$CreditCardBehavior, levels = c(0, 1), labels = c("No", "Yes"))

# Logistic regression model using glm engine
fit_lit <- logistic_reg(engine = "glm") |>
  fit(CreditCardBehavior ~ fin_lit_score, 
      data = df)
```

```{r}
library(ggplot2)
library(dplyr)

# Assuming the object is named `pred_data` from your previous code
# If not, use plot_predictions(..., draw = FALSE) |> as.data.frame()
pred_data_clean <- plot_predictions(fit_lit, type = "prob", condition = "fin_lit_score", draw = FALSE)

ggplot(pred_data_clean, aes(x = fin_lit_score, y = estimate, color = group, fill = group)) +
  geom_line(size = 1.2) +
  geom_ribbon(aes(ymin = conf.low, ymax = conf.high), alpha = 0.15, linetype = 0) +
  scale_y_continuous(labels = scales::percent_format(accuracy = 1)) +
  labs(
    title = "Financial Literacy Score and Credit Card Behavior",
    subtitle = "Higher financial literacy is strongly associated with responsible credit card usage",
    x = "Financial Literacy Score (Standardized)",
    y = "Predicted Probability of Responsible Behavior",
    color = "Credit Card Behavior",
    fill = "Credit Card Behavior",
    caption = "Source: Model predictions from logistic regression on survey data"
  ) +
  theme_minimal(base_size = 14) +
  theme(
    plot.title = element_text(face = "bold", size = 18),
    plot.subtitle = element_text(size = 14, margin = margin(b = 10)),
    legend.position = "top",
    panel.grid.minor = element_blank()
  )

```

Knowledge regarding personal finance has a large impact on financial decisions that every person makes. Using data from the 2021 NFCS survey, we seek to understand the relationship between paying off a credit card bill and financial literacy in people across the United States. We modeled credit card behavior, a binary TRUE/FALSE variable (true meaning always pays card in full, false meaning not always paid), as a logistic function of financial literacy. Individuals with a higher financial literacy score were more likely to pay off their credit card consistently. Therefore, a person who has more financial knowledge will make more sound financial decisions, such as paying off their credit card.
